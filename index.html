<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Log Activity</title>
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center p-6"
  >
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-600">
      AI Log Activity Generator
    </h1>

    <div class="w-full max-w-2xl">
      <label for="activity" class="block mb-2 font-medium"
        >Masukkan Aktivitas Hari Ini:</label
      >
      <textarea
        id="activity"
        class="w-full h-32 p-3 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="Contoh: Hari ini saya belajar dasar Java dan HTTP..."
      ></textarea>

      <button
        id="generateBtn"
        class="mt-4 w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors"
      >
        Generate Log
      </button>

      <!-- Status -->
      <p id="status" class="mt-3 text-sm text-gray-500">Status: Idle</p>

      <!-- Output -->

      <div class="mt-6 space-y-4">
        <div class="bg-white rounded-lg p-4 shadow relative card">
          <h2 class="text-xl font-semibold text-blue-600 mb-2">
            Uraian Aktivitas
          </h2>
          <button
            class="copy-btn absolute top-4 right-4 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm"
          >
            Copy
          </button>
          <pre id="uraian_aktivitas" class="whitespace-pre-wrap">-</pre>
        </div>

        <div class="bg-white rounded-lg p-4 shadow relative card">
          <h2 class="text-xl font-semibold text-blue-600 mb-2">
            Pembelajaran Diperoleh
          </h2>
          <button
            class="copy-btn absolute top-4 right-4 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm"
          >
            Copy
          </button>
          <pre id="pembelajaran_diperoleh" class="whitespace-pre-wrap">-</pre>
        </div>

        <div class="bg-white rounded-lg p-4 shadow relative card">
          <h2 class="text-xl font-semibold text-blue-600 mb-2">
            Kendala Dialami
          </h2>
          <button
            class="copy-btn absolute top-4 right-4 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm"
          >
            Copy
          </button>
          <pre id="kendala_dialami" class="whitespace-pre-wrap">-</pre>
        </div>
      </div>
    </div>

    <script>
      const btn = document.getElementById("generateBtn");
      const activityInput = document.getElementById("activity");
      const statusText = document.getElementById("status");

      btn.addEventListener("click", async () => {
        const textActivity = activityInput.value.trim();
        if (!textActivity) {
          alert("Harap isi aktivitas terlebih dahulu!");
          return;
        }

        // Update status
        statusText.textContent = "Status: Generating...";
        btn.disabled = true;
        btn.classList.add("opacity-50", "cursor-not-allowed");
        statusText.classList.remove("text-red-500");
        statusText.classList.add("text-gray-500");

        try {
          const res = await fetch("http://localhost:3000/api/process", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: textActivity }),
          });

          if (!res.ok) throw new Error("Request gagal");

          const data = await res.json();

          document.getElementById("uraian_aktivitas").textContent =
            data.uraian_aktivitas || "-";
          document.getElementById("pembelajaran_diperoleh").textContent =
            data.pembelajaran_diperoleh || "-";
          document.getElementById("kendala_dialami").textContent =
            data.kendala_dialami || "-";

          statusText.textContent = "Status: Selesai";
          btn.disabled = false;
          btn.classList.remove("opacity-50", "cursor-not-allowed");
          statusText.classList.remove("text-gray-500");
          statusText.classList.add("text-green-600");
        } catch (err) {
          console.log(err);
          statusText.textContent = "Status: Gagal memproses";
          btn.disabled = false;
          btn.classList.remove("opacity-50", "cursor-not-allowed");
          statusText.classList.remove("text-gray-500");
          statusText.classList.add("text-red-500");

          document.getElementById("uraian_aktivitas").textContent = "-";
          document.getElementById("pembelajaran_diperoleh").textContent = "-";
          document.getElementById("kendala_dialami").textContent = "-";
        }
      });

      document.querySelectorAll(".copy-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const pre = btn.nextElementSibling; // elemen <pre> tepat setelah tombol
          const text = pre.textContent;
          if (!text || text === "-") return;

          navigator.clipboard
            .writeText(text)
            .then(() => {
              const original = btn.textContent;
              btn.textContent = "Copied!";
              btn.classList.remove("bg-blue-500");
              btn.classList.add("bg-green-500");

              setTimeout(() => {
                btn.textContent = original;
                btn.classList.remove("bg-green-500");
                btn.classList.add("bg-blue-500");
              }, 1200);
            })
            .catch((err) => {
              console.error("Gagal menyalin teks: ", err);
            });
        });
      });
    </script>
  </body>
</html>
